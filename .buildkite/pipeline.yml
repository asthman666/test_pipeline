steps:
  - label: ":testobject: Test"
    command: "deployment/script/test.sh"
    agents:
      queue: "${BUILDKITE_AGENT_META_DATA_QUEUE:-default}"

  - wait

  - label: ":docker: Push"
    plugins:
      - ecr#v2.7.0:
          login: true
          account_ids: "public.ecr.aws"
      - docker-compose#v4.7.0:
          push:
            - app:public.ecr.aws/k6a7e3i6/test-pipeline:${BUILDKITE_BUILD_NUMBER}
    agents:
      queue: "${BUILDKITE_AGENT_META_DATA_QUEUE:-default}"

  - wait

  - label: ":codedeploy: Deploy"
    command: BUILDKITE_BUILD_NUMBER=$BUILDKITE_BUILD_NUMBER ./deployment/script/deploy.sh
    agents:
      queue: "${BUILDKITE_AGENT_META_DATA_QUEUE:-default}"